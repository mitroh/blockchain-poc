{% extends "base.html" %}
{% block content %}
<div id="posts-container" style="margin: 20px;">
  {% for post in posts %}
  <div class="post_box">
    <div class="post_box-header">
      {% if post.get('seller') %}
      <div style="background: rgb(0, 97, 146) none repeat scroll 0% 0%; box-shadow: rgb(0, 97, 146) 0px 0px 0px 2px;"
        class="post_box-avatar">{{post.seller[0]}}</div>
      <div class="name-header">{{post.seller}}</div>
      {% endif %}
      <div class="post_box-subtitle"> Posted at <i>{{readable_time(post.timestamp)}}</i></div>
    </div>
    <div>
      <div class="post_box-body">
        <p>Document Type: {{post.document_type}}</p>
        <p>Document Number: {{post.document_number}}</p>
        <p>GST Number: {{post.gst_no}}</p>
        <p>Document Date: {{post.document_date}}</p>
        {% if post.get('seller') %}
        <p>Seller: {{post.seller}}</p>
        {% endif %}
        {% if post.get('buyer') %}
        <p>Buyer: {{post.buyer}}</p>
        {% endif %}
        <p>Index: {{post.index}}</p>
        <p>Financial Year: {{ post.financial_year }}</p>
        <p>Transactions: {{post.transactions}}</p>
        <p>Timestamp: {{post.timestamp}}</p>
        <p>Previous Hash: {{post.previous_hash}}</p>
        <p>Current Hash: {{post.current_hash}}</p>
        <p>Status: {{post.status}}</p>
        {% if post.status == 'Cancelled' %}
        <p>Cancellation Reason: {{post.cancellation_reason}}</p>
        {% endif %}
      </div>
    </div>
  </div>
  {% endfor %}
</div>

<style>
  .post_box {
    background: #fff;
    padding: 12px 0px 0px 12px;
    margin-top: 0px;
    margin-bottom: 8px;
    border-top: 1px solid #f0f0f0;
  }
  .post_box-header {
    padding-bottom: 12px;
  }
  .post_box-avatar {
    width: 38px;
    height: 38px;
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    color: white;
    font-size: 22px;
    float: left;
    margin-right: 16px;
    border: 1px solid #fff;
    box-shadow: 0px 0px 0px 2px #f00;
  }
  .post_box-avatar::after {
    content: "";
    display: block;
  }
  .post_box-name {
    font-weight: bold;
  }
  .post_box-subtitle {
    color: #777;
  }
  .post_box-body {
    margin-top: 16px;
    margin-bottom: 8px;
  }
</style>

<script>
  function pollForUpdates() {
    fetch('/transactions')
      .then(response => response.text())
      .then(html => {
        const tempDiv = document.createElement('div');
        tempDiv.innerHTML = html;
        const newPostsContainer = tempDiv.querySelector('#posts-container');
        if (newPostsContainer) {
          document.getElementById('posts-container').innerHTML = newPostsContainer.innerHTML;
        }
      })
      .catch(error => console.error('Error:', error));
  }

  // Poll every 5 seconds
  setInterval(pollForUpdates, 5000);
</script>
{% endblock %}